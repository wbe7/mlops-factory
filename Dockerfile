# --- 1. Базовый образ ---
# Используем официальный образ Python. slim-версия меньше по размеру.
# Аналог: Выбор минимального базового образа ОС (alpine, slim-buster) для ВМ.
FROM python:3.11-slim

# --- 2. Рабочая директория ---
# Устанавливаем рабочую директорию внутри контейнера.
WORKDIR /app

# --- 3. Установка зависимостей ---
# Копируем только файл с зависимостями.
# Docker кэширует этот слой. Если requirements.txt не изменится,
# Docker не будет заново устанавливать зависимости при каждой сборке.
COPY requirements.txt .

# Устанавливаем зависимости. --no-cache-dir уменьшает размер слоя.
RUN pip install --no-cache-dir -r requirements.txt

# --- 4. Копирование кода приложения ---
# Копируем остальные файлы, необходимые для работы.
COPY ./app.py .
COPY ./model.pkl .

# --- 5. Запуск приложения ---
# Указываем порт, который будет слушать наше приложение.
EXPOSE 8000

# Команда для запуска. uvicorn будет слушать на всех интерфейсах (0.0.0.0),
# что необходимо для доступа к приложению извне контейнера.
# --reload здесь НЕ используется, т.к. это для продакшн-сборки.
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
